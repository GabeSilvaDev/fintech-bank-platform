# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# API Gateway - Makefile
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: help test test-unit test-feature test-coverage test-verbose clean run build

# Default target
help:
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  API Gateway - Comandos DisponÃ­veis"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "  make test            - Roda todos os testes com cobertura"
	@echo "  make test-unit       - Roda apenas testes unitÃ¡rios"
	@echo "  make test-feature    - Roda apenas testes de feature"
	@echo "  make test-verbose    - Roda testes com output detalhado"
	@echo "  make test-coverage   - Gera relatÃ³rio HTML de cobertura"
	@echo "  make clean           - Remove arquivos gerados"
	@echo "  make run             - Roda a aplicaÃ§Ã£o localmente"
	@echo "  make build           - Compila a aplicaÃ§Ã£o"
	@echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Testes
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Roda todos os testes com cobertura
test:
	@echo "ğŸ§ª Rodando todos os testes..."
	@go test ./tests/... ./cmd/... -coverprofile=coverage.out -coverpkg=./internal/...
	@go tool cover -func=coverage.out | tail -1

# Roda apenas testes unitÃ¡rios
test-unit:
	@echo "ğŸ”¬ Rodando testes unitÃ¡rios..."
	@go test ./tests/unit/... -v

# Roda apenas testes de feature
test-feature:
	@echo "ğŸ¯ Rodando testes de feature..."
	@go test ./tests/feature/... -v

# Roda testes com output verbose
test-verbose:
	@echo "ğŸ“ Rodando testes com output detalhado..."
	@go test ./tests/... ./cmd/... -v -coverprofile=coverage.out -coverpkg=./internal/...

# Gera relatÃ³rio HTML de cobertura
test-coverage:
	@echo "ğŸ“Š Gerando relatÃ³rio de cobertura..."
	@go test ./tests/... ./cmd/... -coverprofile=coverage.out -coverpkg=./internal/...
	@go tool cover -html=coverage.out -o coverage.html
	@go tool cover -func=coverage.out
	@echo ""
	@echo "âœ… RelatÃ³rio gerado: coverage.html"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Build & Run
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Roda a aplicaÃ§Ã£o
run:
	@go run cmd/main.go

# Compila a aplicaÃ§Ã£o
build:
	@echo "ğŸ”¨ Compilando..."
	@go build -o bin/api-gateway cmd/main.go
	@echo "âœ… BinÃ¡rio gerado: bin/api-gateway"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Docker
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Roda testes no container Docker
docker-test:
	@docker exec fintech-api-gateway go test ./tests/... ./cmd/... -coverprofile=coverage.out -coverpkg=./internal/...
	@docker exec fintech-api-gateway go tool cover -func=coverage.out | tail -1

# Roda testes com cobertura HTML no Docker
docker-coverage:
	@docker exec fintech-api-gateway go test ./tests/... ./cmd/... -coverprofile=coverage.out -coverpkg=./internal/...
	@docker exec fintech-api-gateway go tool cover -func=coverage.out

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Limpeza
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Remove arquivos gerados
clean:
	@rm -f coverage.out coverage.html
	@rm -rf bin/
	@rm -rf tmp/
	@echo "ğŸ§¹ Arquivos limpos"
